FROM socrata/java

# TODO expose JMX
EXPOSE 6060
ENV JMX_PORT 6069
EXPOSE 6069

ENV SERVER_ROOT /srv/soql-server-bq
ENV SERVER_ARTIFACT soql-server-bq-assembly.jar
ENV SERVER_CONFIG soql-server-bq.conf

# defaults
ENV ENABLE_GRAPHITE false
ENV GRAPHITE_HOST 0.0.0.0
ENV GRAPHITE_PORT 0
ENV JAVA_XMX 512m
ENV LOG_METRICS false
ENV PG_SECONDARY_DB_NAME falth
ENV PG_SECONDARY_DB_PORT 5432
ENV PG_SECONDARY_DB_USER soda_query
ENV PG_SECONDARY_MIGRATE_DB_USER soda_store
ENV PG_SECONDARY_INSTANCE pg
ENV PG_SECONDARY_WORK_MEM 256MB
ENV BQ_SECONDARY_INSTANCE bq

WORKDIR $SERVER_ROOT

COPY ship.d /etc/ship.d
COPY ${SERVER_CONFIG}.j2 $SERVER_ROOT/
COPY $SERVER_ARTIFACT $SERVER_ROOT/
