instances {
{% for i in PG_SECONDARY_INSTANCES.split() %}
  {% set name, hostname = i.split(':') %}
  {{ name }} {
    secondaryType = bbq
    numWorkers = {{ BQ_SECONDARY_NUM_WORKERS }}
    config = ${bq-secondary-config}
    config.database.host = "{{ hostname }}"
  }
{% endfor %}
}

bq-secondary-config {
  database {
    app-name = "bq-secondary-store"

    c3p0 {
      maxPoolSize = {{ BQ_SECONDARY_NUM_WORKERS }}
      idleConnectionTestPeriod = 60
      testConnectionOnCheckin = true
      preferredTestQuery = "SELECT 1"
      maxIdleTimeExcessConnections = 300
      connectionCustomizerClassName = com.socrata.thirdparty.c3p0.ConnectionCustomizer
      extensions {
        onAcquire = "SET work_mem = '768MB'; COMMIT"
      }
    }
  }

  # TODOMS figure out right strategy for where this should go 
  log4j {
    rootLogger = [ INFO, console ]
    appender {
      console.class = org.apache.log4j.ConsoleAppender
      console.props {
        layout.class = org.apache.log4j.PatternLayout
        layout.props {
          ConversionPattern = "%d %p [%t] (%X{X-Socrata-RequestId}) [%X{X-Socrata-Resource}] %c{1} %m%n"
        }
      }
    }
  }
}
